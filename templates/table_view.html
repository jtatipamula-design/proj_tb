{% extends "base.html" %}

{% block content %}
<style>
    .header-actions { display: flex; align-items: center; gap: 10px; }
    
    /* Search Bar Style */
    .search-wrapper { position: relative; width: 300px; margin-right: 15px; }
    .search-input {
        width: 100%; padding: 10px 16px;
        border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem;
        background-color: #f8fafc;
        box-sizing: border-box;
    }
    .search-input:focus { outline: none; border-color: #3b82f6; background-color: #fff; }
</style>

<div class="card">
    <div class="card-header">
        <h1>{{ table_title }}</h1>
        <div class="header-actions">
            <div class="search-wrapper">
                <input type="text" id="tableSearch" class="search-input" onkeyup="filterTable()" placeholder="Search rows...">
            </div>

            <a href="/export/{{ table_name }}" class="btn btn-primary" style="background:#10b981;">Download CSV</a>
            <a href="/new/{{ table_name }}" class="btn btn-primary">+ Add New Record</a>
        </div>
    </div>

    <div class="table-container">
        <table id="dataTable">
            <thead>
                <tr>
                    {% for col in columns %}
                    <th>{{ col.label }}</th>
                    {% endfor %}
                    <th style="width: 100px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                <tr>
                    {% for col in columns %}
                    <td>
                        {% if row[col.raw] is not none %}
                            {{ row[col.raw] }}
                        {% else %}
                            <span style="color:#cbd5e1;">-</span>
                        {% endif %}
                    </td>
                    {% endfor %}
                    
                    <td style="display:flex; gap:10px;">
                        {% if pk_column and row[pk_column] %}
                        <a href="/edit/{{ table_name }}/{{ row[pk_column] }}" title="Edit Row" style="text-decoration:none;">
                            ✏️
                        </a>
                        <a href="/export/{{ table_name }}?id={{ row[pk_column] }}" title="Download Row" style="text-decoration:none;">
                            ⬇️
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // Search Filter Logic
    function filterTable() {
        const input = document.getElementById("tableSearch");
        const filter = input.value.toLowerCase();
        const table = document.getElementById("dataTable");
        const tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            let row = tr[i];
            let cells = row.getElementsByTagName("td");
            let matchFound = false;

            // Search all cells except the last one (Actions)
            for (let j = 0; j < cells.length - 1; j++) {
                let cell = cells[j];
                if (cell) {
                    const textValue = cell.textContent || cell.innerText;
                    if (textValue.toLowerCase().indexOf(filter) > -1) {
                        matchFound = true;
                        break;
                    }
                }
            }
            row.style.display = matchFound ? "" : "none";
        }
    }
</script>
{% endblock %}
