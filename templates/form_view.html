{% extends "base.html" %}

{% block content %}
<div class="card" style="max-width: 600px; margin: 0 auto;">
    <h1>{{ table_title }}</h1>
    
    <form onsubmit="submitForm(event)">
        {% for col in columns %}
        <div class="form-group" style="margin-bottom: 15px;">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">{{ col.label }}</label>
            
            {% if col.data_type == 'date' %}
                <input type="date" name="{{ col.column_name }}" value="{{ col.value }}" {% if col.required %}required{% endif %} style="width:100%; padding:8px;">
            {% else %}
                <input type="text" name="{{ col.column_name }}" value="{{ col.value }}" {% if col.required %}required{% endif %} style="width:100%; padding:8px;">
            {% endif %}
        </div>
        {% endfor %}
        
        <button type="submit" class="btn btn-primary" style="width:100%; margin-top:20px;">Save Record</button>
    </form>
</div>

<script>
    async function submitForm(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());

        // Determine if creating or editing
        const mode = "{{ mode }}";
        const url = mode === "edit" ? "/api/{{ table_name }}/{{ pk_val }}" : "/api/{{ table_name }}";
        const method = mode === "edit" ? "PUT" : "POST";

        const res = await fetch(url, {
            method: method,
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        if (res.ok) {
            window.location.href = "/table/{{ table_name }}";
        } else {
            alert("Error saving data");
        }
    }
</script>
{% endblock %}
